# cbc-simulator
A simulator for testing CBC protocol 

# Input
* Input 1. A JSON object representing the genesis bond map:
```JSON
"GenesisBondMap": {
  "A" : 10000,
  "B" : 15000,
  "C" :  8000
}

```

* Input 2. Network topology
```
"Connection": {
  "pairs": ["A", "B"],                 // Pair of validators
  "latency_pctl": [2,5,...., 10000],   // Percentile of latency disribution
  "failure_prob": 0.001,	             // Hazard rate of outage
 }
```
Note: there will be an assistent function to create Kademlia topology for given set of validators

* Input 3. A **stream** of JSON objects representing transactions arriving at each validator, ordered by timestamp
```
"TxnReceived": {
  "timestamp"   : 1657823266745 // Timestamp
  "validator_id": "B",          // Validator ID
  "tx_id": "xxxx",              //Transaction id
}
```
# Simulator output
Simulator consists of actors simulating the behaviors of validators and network connections and produces three type of events:
	
* BlockProposed 
* BlockReceived 
* FringeFound 

The data structure of these events are:

* BlockReceivedEvent. Represents a "block received" event:
```
"BlockProposedEvent": {
  "block_id": "B_6",                  // Block ID
  "timestamp": 1657823266745,         // UTC timestamp of block time    
  "validator_id": "B",                // This block is proposed by validator_id    
  "justification": ["A_3",...,"E_5"]  // Each element is another block_id
}
```

* BlockReceivedEvent. Represents a "block received" event:
```
"BlockReceivedEvent": {
  "timestamp": 1657823266745,  // UTC timestamp of this event
  "block_id": "A3",            // block id
  "received_by": "B",          // Validator id of the validator that has received the block
}   
```


* FringeFoundEvent. Represents an event that a validator idenifies a finalization fringe with the given CBC safety oracle
```
"FringeFoundEvent": {
  "timestamp": 1657823266745,            // Timestamp of this event
  "validator_id": "B",                   // 	
  "fringe": ["A_2", "B_2", ..., "E_2"],
}
```

** Note 1. The later two events are not Casper messages. It is used to visualize how the whole system evolves as CBC works. Only BlockProposed message can be used as input to consensus protocol. 

** Note 2 The "timestamp" should not be used in consensus. It can not be trusted in blockchain setting, and here it is only used for visualization purpose.

** Note 3:  the "FringeFoundEvent" is to be generated by the Casper CBC protocol. The simulator is designed to allow finalizers with different parameters to generate these events to provide clues of how to fine tune the protocol.

**Note 4:  the event stream will be connected to visualizer. And this stream can also be generated from a logger, a Redis/RabbitMQ/Kafka subscription, a websocket stream etc. We can hook the visualizer/animator up to simulator or log collectors of testnet in the future.



# Visualizer / Animator
Output: animation of an consolidated DAG view and a per validator DAG view.



